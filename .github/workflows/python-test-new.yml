name: Full Python CI/CD Pipeline

on:
  push:
    branches:
      - main

jobs:
  build-test-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ KodlarÄ± al
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Python ortamÄ±nÄ± kur
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3ï¸âƒ£ BaÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼kle
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt || echo "requirements.txt bulunamadÄ±"
          pip install pytest pytest-cov flake8

      # 4ï¸âƒ£ Kod kalitesi (Linting)
      - name: Run linting
        run: |
          echo "ğŸ§¹ Kod kalitesi kontrol ediliyor..."
          flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
          flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics

      # 5ï¸âƒ£ Unit testler
      - name: Run unit tests
        run: |
          echo "ğŸ§ª Unit testler Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..."
          pytest -v --maxfail=1 --disable-warnings --cov=.

      # 6ï¸âƒ£ Integration testler
      - name: Run integration tests
        run: |
          echo "ğŸ”— Integration testler baÅŸlatÄ±lÄ±yor..."
          pytest tests/integration || echo "âš ï¸ Integration test dosyasÄ± yok"

      # 7ï¸âƒ£ Docker image build
      - name: Build Docker image
        run: |
          echo "ğŸ³ Docker image oluÅŸturuluyor..."
          docker build -t myapp:latest .

      # 8ï¸âƒ£ Docker image push (Ã¶rnek iÃ§in simÃ¼lasyon)
      - name: Push Docker image (Simulated)
        run: |
          echo "ğŸ“¤ Docker image push ediliyor (Ã¶rnek simÃ¼lasyon)..."
          echo "docker push myregistry/myapp:latest"

      # 9ï¸âƒ£ Deploy aÅŸamasÄ± (Ã¶rnek)
      - name: Deploy to environment (Simulated)
        run: |
          echo "ğŸš€ Deploy iÅŸlemi baÅŸlatÄ±ldÄ± (Ã¶rnek)..."
          sleep 2
          echo "âœ… Deploy tamamlandÄ±."

      # ğŸ”Ÿ Smoke test
      - name: Smoke test after deploy
        run: |
          echo "ğŸ”¥ Smoke test Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yor..."
          curl -Is http://localhost:8000 || echo "âš ï¸ Uygulama eriÅŸilemedi, sadece Ã¶rnek test"

      # ğŸ”” Bildirim
      - name: Notify via Slack and Email
        if: always()
        run: |
          echo "ğŸ“¬ Bildirimler gÃ¶nderiliyor..."
