# Testlerden sonra bildirimi Ã§alÄ±ÅŸtÄ±r
- name: Bildirim gÃ¶nder (E-posta ve Slack)
  if: success()  # testler baÅŸarÄ±lÄ± olursa Ã§alÄ±ÅŸÄ±r
  run: |
    echo "ğŸš€ Testler geÃ§ti, bildirimler gÃ¶nderiliyor..."

    # ---- SLACK BÄ°LDÄ°RÄ°MÄ° ----
    curl -X POST -H 'Content-type: application/json' \
      --data '{"text":"âœ… *TÃ¼m testler baÅŸarÄ±yla geÃ§ti!* \nğŸ“¦ Deploy iÅŸlemi baÅŸlatÄ±lÄ±yor..."}' \
      ${{ secrets.SLACK_WEBHOOK_URL }}

    # ---- E-POSTA BÄ°LDÄ°RÄ°MÄ° ----
    python - <<EOF
    import smtplib
    from email.mime.text import MIMEText

    msg = MIMEText("âœ… TÃ¼m testler baÅŸarÄ±yla geÃ§ti!\nğŸ“¦ Deploy iÅŸlemi baÅŸlatÄ±lÄ±yor...")
    msg["Subject"] = "âœ… Test SonuÃ§larÄ± - BaÅŸarÄ±lÄ±"
    msg["From"] = "${{ secrets.EMAIL_USER }}"
    msg["To"] = "${{ secrets.EMAIL_USER }}"  # istersen farklÄ± alÄ±cÄ± da ekleyebilirsin

    with smtplib.SMTP("${{ secrets.EMAIL_HOST }}", int("${{ secrets.EMAIL_PORT }}")) as server:
        server.starttls()
        server.login("${{ secrets.EMAIL_USER }}", "${{ secrets.EMAIL_PASS }}")
        server.send_message(msg)

    print("ğŸ“¨ E-posta bildirimi gÃ¶nderildi!")
    EOF
